final_height_quant
## Need to look at 1) Most recent MR incidence, 2) Last and last 2 months of MR incidence
### Load in blups
height_byMR <- reg_prediction_gt_plantingexp_summ %>%
group_by(Site, UID_numb, `(Intercept)`) %>%
mutate(n = n()) %>%
filter(n > 2) %>%
group_by(Site, UID_numb) %>%
arrange(Date, .by_group = TRUE) %>%
summarise(Height_diff = (`Height (m)` - lag(`Height (m)`)),
Season = Season,
BLUP = (`(Intercept)`),
MR_impact_overall = mean(`Myrtle rust impact score`),
MR_date = lag(`Myrtle rust worst score`, n=0),
MR_last_date = lag(`Myrtle rust worst score`, n=1),
MR_last_2date = lag(`Myrtle rust worst score`, n=2),
MR_last_3date = lag(`Myrtle rust worst score`, n=3)) %>%
ungroup()
View(reg_prediction_gt_plantingexp_summ)
prediction_gt
## Generate a summarative score for each individual given different lengths of monitoring
mod <- lmer(`Myrtle rust worst score` ~  factor(Date) + (1|UID), data=reg_monit_survey_results_UID)
ranef_scores <- ranef(mod)$UID; ranef_scores<- rownames_to_column(ranef_scores, var="UID"); colnames(ranef_scores)[2] <- "ranef_int" # random intercepts
individual_effects <- coef(mod)$UID; individual_effects<- rownames_to_column(individual_effects, var="UID") # population adjusted BLUPs; global mean + ranef_int.
rough_summ <- reg_monit_survey_results_mat_GT %>% group_by(UID) %>% summarise (rgh_mean=mean(`Myrtle rust worst score`, na.rm=T))
summ <- left_join(rough_summ, ranef_scores); summ <- left_join(reg_monit_survey_results_mat_GT, individual_effects, by="UID")
# Check
reg_prediction_gt_plantingexp_summ <- left_join(reg_monit_survey_results_mat_GT, individual_effects)
## Compare prediction against blup
# Site split
reg_prediction_gt_plantingexp_comp <- ggplot(reg_prediction_gt_plantingexp_summ, aes(x=Prediction, y=`(Intercept)`)) +
geom_point(alpha=0.1) +
geom_smooth(method = 'lm', colour="grey", linetype="dashed", se=F) +
theme_bw() +
labs (title = "Prediction vs BLUP") +
facet_wrap(~Site)
ggsave(reg_prediction_gt_plantingexp_comp, file="~/Uni/Doctorate/Ch Planting/Publication/Plots/reg_prediction_gt_plantingexp_comp.jpg", width=3500, height=2000, units="px", limitsize=F)
## Difference from worst score rescaled to 0,3 vs predicted
reg_prediction_gt_plantingexp_summ$mrws_rescale <- scales::rescale(reg_prediction_gt_plantingexp_summ$`Myrtle rust worst score`, from = c(0,5), to=c(0,3))
reg_prediction_gt_plantingexp_summ$mrws_rescale_pred_diff <- reg_prediction_gt_plantingexp_summ$mrws_rescale - reg_prediction_gt_plantingexp_summ$Prediction
## Difference over time remade\
# Colour individuals with biggest departure
UID_means <- reg_prediction_gt_plantingexp_summ %>%
group_by(UID) %>%
summarise(mean_diff = mean(mrws_rescale_pred_diff, na.rm = TRUE))
prediction_survey_res_alt <- left_join(reg_prediction_gt_plantingexp_summ, UID_means, by = "UID")
colour_thresh=3
prediction_survey_res_alt$UID_highlight <- ifelse(abs(prediction_survey_res_alt$mean_diff) > colour_thresh, prediction_survey_res_alt$UID, "Other")
colours <- length(unique(prediction_survey_res_alt$UID_highlight)) - 1
## Need to look at 1) Most recent MR incidence, 2) Last and last 2 months of MR incidence
### Load in blups
height_byMR <- reg_prediction_gt_plantingexp_summ %>%
group_by(Site, UID_numb, `(Intercept)`) %>%
mutate(n = n()) %>%
filter(n > 2) %>%
group_by(Site, UID_numb) %>%
arrange(Date, .by_group = TRUE) %>%
summarise(Height_diff = (`Height (m)` - lag(`Height (m)`)),
Season = Season,
BLUP = (`(Intercept)`),
MR_impact_overall = mean(`Myrtle rust impact score`),
MR_date = lag(`Myrtle rust worst score`, n=0),
MR_last_date = lag(`Myrtle rust worst score`, n=1),
MR_last_2date = lag(`Myrtle rust worst score`, n=2),
MR_last_3date = lag(`Myrtle rust worst score`, n=3)) %>%
ungroup()
View(reg_prediction_gt_plantingexp_summ)
View(reg_monit_survey_results_mat_GT)
prediction_gt <- read.csv("~/Uni/Doctorate/Samples/Genotyping/Report-DMela25-10753/Report-DMela25-10753/GP_Out/prediction_gt.csv") %>% dplyr::select(c(Taxa, PEV, Prediction))
colnames(prediction_gt)[1] <- "NSWID"
sample_meta_planting <- read_xlsx("C:/Users/swirl/OneDrive/Documents/Uni/Doctorate/Samples/All_samples.xlsx") %>% filter(!is.na(NSWID) & `Genotyping Purpose`=="Planting_experiment") %>% dplyr::select(NSWID, ID)
## Fixing name errors
replacements <- c(
"NSW8770831"  = "NSW770831",
"Mq_HWC_566"  = "Cattai_566",
"Mq_Cattai_780" = "Mq_HWC_780",
"Mq_MLNP_106" = "HWC_106",
"Mq_MLNP_618" = "Cattai_618",
"NSW1214046"  = "NSW1213746"
)
for (i in seq_along(replacements)) {
prediction_gt$NSWID <- gsub(names(replacements)[i], replacements[i], prediction_gt$NSWID)
}
prediction_gt_planted <- left_join(sample_meta_planting, prediction_gt) %>%
filter (!is.na(Prediction)) #Removing those not genotyped or poorly predicted
prediction_gt_planted$UID_numb <- sub(".*_(\\d+)$", "\\1", prediction_gt_planted$NSWID)
prediction_gt_planted$UID <- ifelse(!grepl("Mq", prediction_gt_planted$ID), paste0("Mq_", prediction_gt_planted$ID), prediction_gt_planted$ID)
reg_monit_survey_results_mat_GT <- left_join(reg_monit_survey_results_UID, prediction_gt_planted %>% dplyr::select(UID, PEV, Prediction))
bin_monit_survey_results_mat_GT <- left_join(bin_monit_survey_results_mat, prediction_gt_planted %>% dplyr::select(UID, PEV, Prediction))
View(reg_monit_survey_results_mat_GT)
View(reg_monit_survey_results_UID)
reg_monit_survey_results_mat_GT <- left_join(reg_monit_survey_results, prediction_gt_planted %>% dplyr::select(UID, PEV, Prediction))
View(reg_monit_survey_results_mat_GT)
prediction_gt <- read.csv("~/Uni/Doctorate/Samples/Genotyping/Report-DMela25-10753/Report-DMela25-10753/GP_Out/prediction_gt.csv") %>% dplyr::select(c(Taxa, PEV, Prediction))
colnames(prediction_gt)[1] <- "NSWID"
sample_meta_planting <- read_xlsx("C:/Users/swirl/OneDrive/Documents/Uni/Doctorate/Samples/All_samples.xlsx") %>% filter(!is.na(NSWID) & `Genotyping Purpose`=="Planting_experiment") %>% dplyr::select(NSWID, ID)
## Fixing name errors
replacements <- c(
"NSW8770831"  = "NSW770831",
"Mq_HWC_566"  = "Cattai_566",
"Mq_Cattai_780" = "Mq_HWC_780",
"Mq_MLNP_106" = "HWC_106",
"Mq_MLNP_618" = "Cattai_618",
"NSW1214046"  = "NSW1213746"
)
for (i in seq_along(replacements)) {
prediction_gt$NSWID <- gsub(names(replacements)[i], replacements[i], prediction_gt$NSWID)
}
prediction_gt_planted <- left_join(sample_meta_planting, prediction_gt) %>%
filter (!is.na(Prediction)) #Removing those not genotyped or poorly predicted
prediction_gt_planted$UID_numb <- sub(".*_(\\d+)$", "\\1", prediction_gt_planted$NSWID)
prediction_gt_planted$UID <- ifelse(!grepl("Mq", prediction_gt_planted$ID), paste0("Mq_", prediction_gt_planted$ID), prediction_gt_planted$ID)
reg_monit_survey_results_mat_GT <- left_join(reg_monit_survey_results, prediction_gt_planted %>% dplyr::select(UID, PEV, Prediction))
bin_monit_survey_results_mat_GT <- left_join(bin_monit_survey_results, prediction_gt_planted %>% dplyr::select(UID, PEV, Prediction))
prediction_gt
## Generate a summarative score for each individual given different lengths of monitoring
mod <- lmer(`Myrtle rust worst score` ~  factor(Date) + (1|UID), data=reg_monit_survey_results_UID)
ranef_scores <- ranef(mod)$UID; ranef_scores<- rownames_to_column(ranef_scores, var="UID"); colnames(ranef_scores)[2] <- "ranef_int" # random intercepts
individual_effects <- coef(mod)$UID; individual_effects<- rownames_to_column(individual_effects, var="UID") # population adjusted BLUPs; global mean + ranef_int.
rough_summ <- reg_monit_survey_results_mat_GT %>% group_by(UID) %>% summarise (rgh_mean=mean(`Myrtle rust worst score`, na.rm=T))
summ <- left_join(rough_summ, ranef_scores); summ <- left_join(reg_monit_survey_results_mat_GT, individual_effects, by="UID")
# Check
reg_prediction_gt_plantingexp_summ <- left_join(reg_monit_survey_results_mat_GT, individual_effects)
## Compare prediction against blup
# Site split
reg_prediction_gt_plantingexp_comp <- ggplot(reg_prediction_gt_plantingexp_summ, aes(x=Prediction, y=`(Intercept)`)) +
geom_point(alpha=0.1) +
geom_smooth(method = 'lm', colour="grey", linetype="dashed", se=F) +
theme_bw() +
labs (title = "Prediction vs BLUP") +
facet_wrap(~Site)
ggsave(reg_prediction_gt_plantingexp_comp, file="~/Uni/Doctorate/Ch Planting/Publication/Plots/reg_prediction_gt_plantingexp_comp.jpg", width=3500, height=2000, units="px", limitsize=F)
## Difference from worst score rescaled to 0,3 vs predicted
reg_prediction_gt_plantingexp_summ$mrws_rescale <- scales::rescale(reg_prediction_gt_plantingexp_summ$`Myrtle rust worst score`, from = c(0,5), to=c(0,3))
reg_prediction_gt_plantingexp_summ$mrws_rescale_pred_diff <- reg_prediction_gt_plantingexp_summ$mrws_rescale - reg_prediction_gt_plantingexp_summ$Prediction
## Difference over time remade\
# Colour individuals with biggest departure
UID_means <- reg_prediction_gt_plantingexp_summ %>%
group_by(UID) %>%
summarise(mean_diff = mean(mrws_rescale_pred_diff, na.rm = TRUE))
prediction_survey_res_alt <- left_join(reg_prediction_gt_plantingexp_summ, UID_means, by = "UID")
colour_thresh=3
prediction_survey_res_alt$UID_highlight <- ifelse(abs(prediction_survey_res_alt$mean_diff) > colour_thresh, prediction_survey_res_alt$UID, "Other")
colours <- length(unique(prediction_survey_res_alt$UID_highlight)) - 1
## Need to look at 1) Most recent MR incidence, 2) Last and last 2 months of MR incidence
### Load in blups
height_byMR <- reg_prediction_gt_plantingexp_summ %>%
group_by(Site, UID_numb, `(Intercept)`) %>%
mutate(n = n()) %>%
filter(n > 2) %>%
group_by(Site, UID_numb) %>%
arrange(Date, .by_group = TRUE) %>%
summarise(Height_diff = (`Height (m)` - lag(`Height (m)`)),
Season = Season,
BLUP = (`(Intercept)`),
MR_impact_overall = mean(`Myrtle rust impact score`),
MR_date = lag(`Myrtle rust worst score`, n=0),
MR_last_date = lag(`Myrtle rust worst score`, n=1),
MR_last_2date = lag(`Myrtle rust worst score`, n=2),
MR_last_3date = lag(`Myrtle rust worst score`, n=3)) %>%
ungroup()
Height_x_MR_date <- ggplot() +
geom_point(data = height_byMR, aes(x=MR_date, Height_diff, colour=BLUP), alpha = 0.5) +
facet_wrap(~Site) +
geom_smooth(method="lm", data = height_byMR, aes(x=MR_date, Height_diff, group=BLUP, colour=BLUP), linewidth=0.5, alpha = 0.05) +
theme_bw() +
theme(legend.position='none')
Height_x_MR_last_date <- ggplot() +
geom_point(data = height_byMR, aes(x=MR_last_date, Height_diff, colour=BLUP), alpha = 0.5) +
facet_wrap(~Site) +
geom_smooth(method="lm", data = height_byMR, aes(x=MR_last_date, Height_diff, fill=BLUP, group=BLUP, colour=BLUP), linewidth=0.5, alpha = 0.05) +
theme_bw() +
theme(legend.position='none')
Height_x_MR_last_2date <- ggplot() +
geom_point(data = height_byMR, aes(x=MR_last_2date, Height_diff, colour=BLUP), alpha = 0.5) +
facet_wrap(~Site) +
geom_smooth(method="lm", data = height_byMR, aes(x=MR_last_2date, Height_diff, fill=BLUP, group=BLUP, colour=BLUP), linewidth=0.5, alpha = 0.05) +
theme_bw() +
theme(legend.position='none')
Height_x_MR_last_3date <- ggplot() +
geom_point(data = height_byMR, aes(x=MR_last_3date, Height_diff, colour=BLUP), alpha = 0.5) +
facet_wrap(~Site) +
geom_smooth(method="lm", data = height_byMR, aes(x=MR_last_3date, Height_diff, fill=BLUP, group=BLUP, colour=BLUP), linewidth=0.5, alpha = 0.05) +
theme_bw() +
theme(legend.position='none')
Height_x_MR_mean_imp <- ggplot() +
geom_point(data = height_byMR, aes(x=MR_impact_overall, Height_diff, colour=BLUP), alpha = 0.5) +
facet_wrap(~Site) +
geom_smooth(method="lm", data = height_byMR, aes(x=MR_impact_overall, Height_diff, group=BLUP, fill=BLUP, colour=BLUP), linewidth=0.5, alpha = 0.05) +
theme_bw() +
theme(legend.position='none')
plot_all_height_MRrecent <- Height_x_MR_date / Height_x_MR_last_date / Height_x_MR_last_2date / Height_x_MR_last_3date / Height_x_MR_mean_imp + theme(legend.position='none')
ggsave(plot_all_height_MRrecent, file="~/Uni/Doctorate/Ch Planting/Publication/Plots/plot_all_height_MRrecent.jpg", width=2000, height=4500, units="px", limitsize=F)
### Load in blups
summary(lmer(data = height_byMR, formula = (Height_diff ~ MR_last_3date + BLUP + (1|UID_numb))))
summary(lmer(data = height_byMR, formula = (Height_diff ~ MR_last_3date + BLUP + Summer + (1|UID_numb))))
summary(lmer(data = height_byMR, formula = (Height_diff ~ MR_last_3date + BLUP + Season + (1|UID_numb))))
summary(lmer(data = height_byMR, formula = (Height_diff ~ MR_last_date + BLUP + (1|Season) + (1|UID_numb))))
Height_x_MR_date <- ggplot() +
geom_point(data = height_byMR, aes(x=MR_date, Height_diff, colour=BLUP), alpha = 0.5) +
facet_wrap(~Site) +
geom_smooth(method="lm", data = height_byMR, aes(x=MR_date, Height_diff), linewidth=0.5, alpha = 0.05) +
theme_bw() +
theme(legend.position='none')
Height_x_MR_last_date <- ggplot() +
geom_point(data = height_byMR, aes(x=MR_last_date, Height_diff, colour=BLUP), alpha = 0.5) +
facet_wrap(~Site) +
geom_smooth(method="lm", data = height_byMR, aes(x=MR_last_date, Height_diff), linewidth=0.5, alpha = 0.05) +
theme_bw() +
theme(legend.position='none')
Height_x_MR_last_2date <- ggplot() +
geom_point(data = height_byMR, aes(x=MR_last_2date, Height_diff, colour=BLUP), alpha = 0.5) +
facet_wrap(~Site) +
geom_smooth(method="lm", data = height_byMR, aes(x=MR_last_2date, Height_diff), linewidth=0.5, alpha = 0.05) +
theme_bw() +
theme(legend.position='none')
Height_x_MR_last_3date <- ggplot() +
geom_point(data = height_byMR, aes(x=MR_last_3date, Height_diff, colour=BLUP), alpha = 0.5) +
facet_wrap(~Site) +
geom_smooth(method="lm", data = height_byMR, aes(x=MR_last_3date, Height_diff), linewidth=0.5, alpha = 0.05) +
theme_bw() +
theme(legend.position='none')
Height_x_MR_mean_imp <- ggplot() +
geom_point(data = height_byMR, aes(x=MR_impact_overall, Height_diff, colour=BLUP), alpha = 0.5) +
facet_wrap(~Site) +
geom_smooth(method="lm", data = height_byMR, aes(x=MR_impact_overall, Height_diff), linewidth=0.5, alpha = 0.05) +
theme_bw() +
theme(legend.position='none')
plot_all_height_MRrecent <- Height_x_MR_date / Height_x_MR_last_date / Height_x_MR_last_2date / Height_x_MR_last_3date / Height_x_MR_mean_imp + theme(legend.position='none')
ggsave(plot_all_height_MRrecent, file="~/Uni/Doctorate/Ch Planting/Publication/Plots/plot_all_height_MRrecent.jpg", width=2000, height=4500, units="px", limitsize=F)
shiny::runApp('Uni/Doctorate/Samples/Seedlot_plot_data/Seedlot_plot_ShinyMap')
runApp('Uni/Doctorate/Samples/Seedlot_plot_data/Seedlot_plot_ShinyMap')
runApp('Uni/Doctorate/Samples/Seedlot_plot_data/Seedlot_plot_ShinyMap')
runApp('Uni/Doctorate/Samples/Seedlot_plot_data/Seedlot_plot_ShinyMap')
runApp('Uni/Doctorate/Samples/Seedlot_plot_data/Seedlot_plot_ShinyMap')
library(tidyverse) # data wrangling
library(raster) # Map
library(sf) # Map
library(shiny) # shiny base package
library(shinycssloaders) # load symbol
library(leaflet) # Map
library(shinyBS) # layout
library(waiter) # loading sign reactively
library(shinyjs) # shiny java
library(DT) # Render datatable
library(shinyWidgets) # Confirmation messages
setwd("~/Uni/Doctorate/Samples/Seedlot_plot_data/")
# Load in datasets used
LoadedinData <- read.csv("data/final_seedloty_plot.csv")
# Load current projection data
maxent_MQuin <- raster("data/maxent_MQuin.tiff")
maxent_MR <- raster("data/maxent_MR.tiff")
maxent_intersection <- raster("data/maxent_intersection.tiff")
maxent_studyarea <- st_read("data/maxent_studyarea.gpkg")
# Palettes
# For seedlots based on severity - actively shifts based on observed data
MR_Sev_pal <- colorNumeric(
palette = "YlOrRd",  # Yellow → Orange → Red
domain = LoadedinData$Mean_seedling_score_rustassay,
na.color = "gray50"
)
# For SDMs
pal_mr <- colorRampPalette(c("grey95","#C6DC96","#C6DC96","darkolivegreen","yellow"))
pal_mq <- colorRampPalette(c("grey95","#EAC8BF","#EAC8BF","orange","forestgreen"))
pal_int <- colorRampPalette(c("grey95","#C6DC96","#C6DC96","#45B055","#4870BD", "deeppink4"))
data <- LoadedinData
LoadedinData_rounded <- LoadedinData %>%
mutate_if(is.numeric, round, digits = 2)
View(LoadedinData_rounded)
LoadedinData_rounded %>%
count(Seedlot) %>%
arrange(desc(n))
library(readxl)
## Creating spreadsheet
### Prev project
seedlings_all <- read.csv ("~/RBGSyd_Technical Officer/MQuin/Processing Meta/Mquin_samples_pheno.csv") # Meta data for seedlings including height and COI of all seedlings, including those that didn't get genotypes
JB_db <- seedlings_all %>%
group_by(FID) %>%
summarise(Seedlot = FID,
Seedling_number_rustassay = n(),
Mean_seedling_score_rustassay = mean(COI, na.rm=T),
Sd_seedling_score_rustassay = sd(COI, na.rm=T),
latitude = Lat,
longitude = Long) %>%
unique() %>%
ungroup() %>%
select(-c(FID))
### Adilts from Prev project
parent_meta_lib <- read.csv ("~/Uni/Doctorate/Ch2 Stressor/parent_meta.csv") %>%
dplyr::select(NSWID, sample_lib_NSW)
Mat_line_droughttol <- read.csv(file = "C:/Users/swirl/OneDrive/Documents/RBGSyd_Technical Officer/MQuin/Seedling GWAS/Filtering/Iteration 6/data/GAPIT_49/prediction_gt.csv")
colnames(Mat_line_droughttol)[1] <- 'sample_lib_NSW'
Mat_line_droughttol <- left_join(Mat_line_droughttol, parent_meta_lib) %>%
dplyr::select (NSWID, Prediction)
colnames(Mat_line_droughttol) <- c("Seedlot", "MatLine_Genompred")
JB_db_MatlineGenompred <- left_join(JB_db, Mat_line_droughttol)
## Add in drought seedling predictions individuals
sample_meta_drought <- readxl::read_xlsx("C:/Users/swirl/OneDrive/Documents/Uni/Doctorate/Samples/All_samples.xlsx") %>% filter(!is.na(NSWID) & `Genotyping Purpose`=="Drought_experiment") %>% dplyr::select(NSWID, Drought_Exp_ID)
colnames(sample_meta_drought)[2] <- c("IID"); sample_meta_drought$IID <- as.numeric(sample_meta_drought$IID)
prediction_gt <- read.csv("~/Uni/Doctorate/Samples/Genotyping/Report-DMela25-10753/Report-DMela25-10753/GP_Out/prediction_gt_main.csv") %>% dplyr::select(c(Taxa, PEV, Prediction))
colnames(prediction_gt)[1] <- "NSWID"
prediction_gt_droughtexp <- inner_join(prediction_gt, sample_meta_drought, by="NSWID")
prediction_gt_droughtexp_rmpoorsamp <- prediction_gt_droughtexp %>% filter(PEV < 0.5)
IID_block <- read_xlsx(path="~/Uni/Doctorate/Ch2 Stressor/FID Selection & ID & Randomisation_vers1.xlsx", sheet = 'real_IID_Block_Cell_12tray') %>%  select(IID, Mat_Line)
IID_block <- left_join(IID_block, sample_meta_drought)
prediction_gt_droughtexp_rmpoorsamp <- left_join(IID_block, prediction_gt_droughtexp_rmpoorsamp) %>%
filter(!is.na(Prediction)) %>%
select(-c(NSWID))
# Add in GP from iter 48
iter_48_GP <- read.csv("~/RBGSyd_Technical Officer/MQuin/Seedling GWAS/Filtering/Iteration 6/data/GAPIT_48/prediction_gt.csv"); colnames(iter_48_GP)[1] <- "LIBRARY"
prev_exp_pedi <- read.csv("~/Uni/Doctorate/Samples/Seedlot_plot_data/prev_exp_pedi.csv")
prev_exp_pedi <- read.csv("~/Uni/Doctorate/Samples/Seedlot_plot_data/prev_exp_pedi.csv")
prev_exp_pedi <- read.csv("~/Uni/Doctorate/Samples/Seedlot_plot_data/data/prev_exp_pedi.csv")
library(readxl)
## Creating spreadsheet
### Prev project
seedlings_all <- read.csv ("~/RBGSyd_Technical Officer/MQuin/Processing Meta/Mquin_samples_pheno.csv") # Meta data for seedlings including height and COI of all seedlings, including those that didn't get genotypes
JB_db <- seedlings_all %>%
group_by(FID) %>%
summarise(Seedlot = FID,
Seedling_number_rustassay = n(),
Mean_seedling_score_rustassay = mean(COI, na.rm=T),
Sd_seedling_score_rustassay = sd(COI, na.rm=T),
latitude = Lat,
longitude = Long) %>%
unique() %>%
ungroup() %>%
select(-c(FID))
### Adilts from Prev project
parent_meta_lib <- read.csv ("~/Uni/Doctorate/Ch2 Stressor/parent_meta.csv") %>%
dplyr::select(NSWID, sample_lib_NSW)
Mat_line_droughttol <- read.csv(file = "C:/Users/swirl/OneDrive/Documents/RBGSyd_Technical Officer/MQuin/Seedling GWAS/Filtering/Iteration 6/data/GAPIT_49/prediction_gt.csv")
colnames(Mat_line_droughttol)[1] <- 'sample_lib_NSW'
Mat_line_droughttol <- left_join(Mat_line_droughttol, parent_meta_lib) %>%
dplyr::select (NSWID, Prediction)
colnames(Mat_line_droughttol) <- c("Seedlot", "MatLine_Genompred")
JB_db_MatlineGenompred <- left_join(JB_db, Mat_line_droughttol)
## Add in drought seedling predictions individuals
sample_meta_drought <- readxl::read_xlsx("C:/Users/swirl/OneDrive/Documents/Uni/Doctorate/Samples/All_samples.xlsx") %>% filter(!is.na(NSWID) & `Genotyping Purpose`=="Drought_experiment") %>% dplyr::select(NSWID, Drought_Exp_ID)
colnames(sample_meta_drought)[2] <- c("IID"); sample_meta_drought$IID <- as.numeric(sample_meta_drought$IID)
prediction_gt <- read.csv("~/Uni/Doctorate/Samples/Genotyping/Report-DMela25-10753/Report-DMela25-10753/GP_Out/prediction_gt_main.csv") %>% dplyr::select(c(Taxa, PEV, Prediction))
colnames(prediction_gt)[1] <- "NSWID"
prediction_gt_droughtexp <- inner_join(prediction_gt, sample_meta_drought, by="NSWID")
prediction_gt_droughtexp_rmpoorsamp <- prediction_gt_droughtexp %>% filter(PEV < 0.5)
IID_block <- read_xlsx(path="~/Uni/Doctorate/Ch2 Stressor/FID Selection & ID & Randomisation_vers1.xlsx", sheet = 'real_IID_Block_Cell_12tray') %>%  select(IID, Mat_Line)
IID_block <- left_join(IID_block, sample_meta_drought)
prediction_gt_droughtexp_rmpoorsamp <- left_join(IID_block, prediction_gt_droughtexp_rmpoorsamp) %>%
filter(!is.na(Prediction)) %>%
select(-c(NSWID))
# Add in GP from iter 48
iter_48_GP <- read.csv("~/RBGSyd_Technical Officer/MQuin/Seedling GWAS/Filtering/Iteration 6/data/GAPIT_48/prediction_gt.csv"); colnames(iter_48_GP)[1] <- "LIBRARY"
prev_exp_pedi <- read.csv("~/Uni/Doctorate/Samples/Seedlot_plot_data/data/prev_exp_pedi.csv")
prev_exp_pedi$FID <- gsub ("_", "", prev_exp_pedi$FID)
iter_48_GP_pedi <- left_join(iter_48_GP, prev_exp_pedi) %>%
select(LIBRARY, FID, Prediction, PEV)
colnames(prediction_gt_droughtexp_rmpoorsamp) <- c("LIBRARY", "FID", "Prediction", "PEV")
iter_48_GP_pedi_drought <- rbind(prediction_gt_droughtexp_rmpoorsamp, iter_48_GP_pedi)
iter_48_GP_pedi_summ <- iter_48_GP_pedi_drought %>%
group_by(FID) %>%
summarise(Seedling_number_genompred = n(),
Mean_seedling_score_genompred = mean(Prediction, na.rm=T),
Sd_seedling_score_genompred = sd(Prediction, na.rm=T))
colnames(iter_48_GP_pedi_summ)[1] <- "Seedlot"
JB_db_iter48 <- left_join(JB_db_MatlineGenompred, iter_48_GP_pedi_summ)
JB_db_iter48$Mean_seedling_score_genompred[JB_db_iter48$Mean_seedling_score_genompred<0] = 0
write.csv(JB_db_iter48, "~/Uni/Doctorate/Samples/Seedlot_plot_data/final_seedloty_plot.csv", row.names=F)
View(JB_db_iter48)
View(iter_48_GP_pedi_summ)
View(JB_db_MatlineGenompred)
View(JB_db)
View(Mat_line_droughttol)
Mat_line_droughttol <- left_join(Mat_line_droughttol, parent_meta_lib) %>%
dplyr::select (NSWID, Prediction) %>%
unique()
View(Mat_line_droughttol)
Mat_line_droughttol[!duplicated(Mat_line_droughttol$Seedlot),]
library(readxl)
## Creating spreadsheet
### Prev project
seedlings_all <- read.csv ("~/RBGSyd_Technical Officer/MQuin/Processing Meta/Mquin_samples_pheno.csv") # Meta data for seedlings including height and COI of all seedlings, including those that didn't get genotypes
JB_db <- seedlings_all %>%
group_by(FID) %>%
summarise(Seedlot = FID,
Seedling_number_rustassay = n(),
Mean_seedling_score_rustassay = mean(COI, na.rm=T),
Sd_seedling_score_rustassay = sd(COI, na.rm=T),
latitude = Lat,
longitude = Long) %>%
unique() %>%
ungroup() %>%
select(-c(FID))
### Adilts from Prev project
parent_meta_lib <- read.csv ("~/Uni/Doctorate/Ch2 Stressor/parent_meta.csv") %>%
dplyr::select(NSWID, sample_lib_NSW)
Mat_line_droughttol <- read.csv(file = "C:/Users/swirl/OneDrive/Documents/RBGSyd_Technical Officer/MQuin/Seedling GWAS/Filtering/Iteration 6/data/GAPIT_49/prediction_gt.csv")
colnames(Mat_line_droughttol)[1] <- 'sample_lib_NSW'
Mat_line_droughttol <- left_join(Mat_line_droughttol, parent_meta_lib) %>%
dplyr::select (NSWID, Prediction)Mat_line_droughttol
Mat_line_droughttol_rmdup <- Mat_line_droughttol[!duplicated(Mat_line_droughttol$Seedlot), ]
library(readxl)
## Creating spreadsheet
### Prev project
seedlings_all <- read.csv ("~/RBGSyd_Technical Officer/MQuin/Processing Meta/Mquin_samples_pheno.csv") # Meta data for seedlings including height and COI of all seedlings, including those that didn't get genotypes
JB_db <- seedlings_all %>%
group_by(FID) %>%
summarise(Seedlot = FID,
Seedling_number_rustassay = n(),
Mean_seedling_score_rustassay = mean(COI, na.rm=T),
Sd_seedling_score_rustassay = sd(COI, na.rm=T),
latitude = Lat,
longitude = Long) %>%
unique() %>%
ungroup() %>%
select(-c(FID))
### Adilts from Prev project
parent_meta_lib <- read.csv ("~/Uni/Doctorate/Ch2 Stressor/parent_meta.csv") %>%
dplyr::select(NSWID, sample_lib_NSW)
Mat_line_droughttol <- read.csv(file = "C:/Users/swirl/OneDrive/Documents/RBGSyd_Technical Officer/MQuin/Seedling GWAS/Filtering/Iteration 6/data/GAPIT_49/prediction_gt.csv")
colnames(Mat_line_droughttol)[1] <- 'sample_lib_NSW'
Mat_line_droughttol <- left_join(Mat_line_droughttol, parent_meta_lib) %>%
dplyr::select (NSWID, Prediction)Mat_line_droughttol
Mat_line_droughttol_rmdup <- Mat_line_droughttol[!duplicated(Mat_line_droughttol$Seedlot), ]
colnames(Mat_line_droughttol_rmdup) <- c("Seedlot", "MatLine_Genompred")
JB_db_MatlineGenompred <- left_join(JB_db, Mat_line_droughttol_rmdup)
View(Mat_line_droughttol_rmdup)
Mat_line_droughttol <- left_join(Mat_line_droughttol, parent_meta_lib) %>%
dplyr::select (NSWID, Prediction)Mat_line_droughttol
Mat_line_droughttol_rmdup <- Mat_line_droughttol[!duplicated(Mat_line_droughttol$Seedlot), ]
View(Mat_line_droughttol_rmdup)
duplicated(Mat_line_droughttol$Seedlot)
Mat_line_droughttol$Seedlot
Mat_line_droughttol_rmdup <- Mat_line_droughttol[!duplicated(Mat_line_droughttol$sample_lib_NSW), ]
View(Mat_line_droughttol_rmdup)
Mat_line_droughttol_rmdup <- Mat_line_droughttol[!duplicated(Mat_line_droughttol$sample_lib_NSW), ]
### Adilts from Prev project
parent_meta_lib <- read.csv ("~/Uni/Doctorate/Ch2 Stressor/parent_meta.csv") %>%
dplyr::select(NSWID, sample_lib_NSW)
Mat_line_droughttol <- read.csv(file = "C:/Users/swirl/OneDrive/Documents/RBGSyd_Technical Officer/MQuin/Seedling GWAS/Filtering/Iteration 6/data/GAPIT_49/prediction_gt.csv")
colnames(Mat_line_droughttol)[1] <- 'sample_lib_NSW'
Mat_line_droughttol <- left_join(Mat_line_droughttol, parent_meta_lib) %>%
dplyr::select (NSWID, Prediction)
Mat_line_droughttol_rmdup <- Mat_line_droughttol[!duplicated(Mat_line_droughttol$NSWID), ]
View(Mat_line_droughttol_rmdup)
View(Mat_line_droughttol)
colnames(Mat_line_droughttol_rmdup) <- c("Seedlot", "MatLine_Genompred")
JB_db_MatlineGenompred <- left_join(JB_db, Mat_line_droughttol_rmdup)
sample_meta_drought <- readxl::read_xlsx("C:/Users/swirl/OneDrive/Documents/Uni/Doctorate/Samples/All_samples.xlsx") %>% filter(!is.na(NSWID) & `Genotyping Purpose`=="Drought_experiment") %>% dplyr::select(NSWID, Drought_Exp_ID)
colnames(sample_meta_drought)[2] <- c("IID"); sample_meta_drought$IID <- as.numeric(sample_meta_drought$IID)
prediction_gt <- read.csv("~/Uni/Doctorate/Samples/Genotyping/Report-DMela25-10753/Report-DMela25-10753/GP_Out/prediction_gt_main.csv") %>% dplyr::select(c(Taxa, PEV, Prediction))
colnames(prediction_gt)[1] <- "NSWID"
library(readxl)
## Creating spreadsheet
### Prev project
seedlings_all <- read.csv ("~/RBGSyd_Technical Officer/MQuin/Processing Meta/Mquin_samples_pheno.csv") # Meta data for seedlings including height and COI of all seedlings, including those that didn't get genotypes
JB_db <- seedlings_all %>%
group_by(FID) %>%
summarise(Seedlot = FID,
Seedling_number_rustassay = n(),
Mean_seedling_score_rustassay = mean(COI, na.rm=T),
Sd_seedling_score_rustassay = sd(COI, na.rm=T),
latitude = Lat,
longitude = Long) %>%
unique() %>%
ungroup() %>%
select(-c(FID))
### Adilts from Prev project
parent_meta_lib <- read.csv ("~/Uni/Doctorate/Ch2 Stressor/parent_meta.csv") %>%
dplyr::select(NSWID, sample_lib_NSW)
Mat_line_droughttol <- read.csv(file = "C:/Users/swirl/OneDrive/Documents/RBGSyd_Technical Officer/MQuin/Seedling GWAS/Filtering/Iteration 6/data/GAPIT_49/prediction_gt.csv")
colnames(Mat_line_droughttol)[1] <- 'sample_lib_NSW'
Mat_line_droughttol <- left_join(Mat_line_droughttol, parent_meta_lib) %>%
dplyr::select (NSWID, Prediction)
Mat_line_droughttol_rmdup <- Mat_line_droughttol[!duplicated(Mat_line_droughttol$NSWID), ]
colnames(Mat_line_droughttol_rmdup) <- c("Seedlot", "MatLine_Genompred")
JB_db_MatlineGenompred <- left_join(JB_db, Mat_line_droughttol_rmdup)
## Add in drought seedling predictions individuals
sample_meta_drought <- readxl::read_xlsx("C:/Users/swirl/OneDrive/Documents/Uni/Doctorate/Samples/All_samples.xlsx") %>% filter(!is.na(NSWID) & `Genotyping Purpose`=="Drought_experiment") %>% dplyr::select(NSWID, Drought_Exp_ID)
colnames(sample_meta_drought)[2] <- c("IID"); sample_meta_drought$IID <- as.numeric(sample_meta_drought$IID)
prediction_gt <- read.csv("~/Uni/Doctorate/Samples/Genotyping/Report-DMela25-10753/Report-DMela25-10753/GP_Out/prediction_gt_main.csv") %>% dplyr::select(c(Taxa, PEV, Prediction))
colnames(prediction_gt)[1] <- "NSWID"
prediction_gt_droughtexp <- inner_join(prediction_gt, sample_meta_drought, by="NSWID")
prediction_gt_droughtexp_rmpoorsamp <- prediction_gt_droughtexp %>% filter(PEV < 0.5)
IID_block <- read_xlsx(path="~/Uni/Doctorate/Ch2 Stressor/FID Selection & ID & Randomisation_vers1.xlsx", sheet = 'real_IID_Block_Cell_12tray') %>%  select(IID, Mat_Line)
IID_block <- left_join(IID_block, sample_meta_drought)
prediction_gt_droughtexp_rmpoorsamp <- left_join(IID_block, prediction_gt_droughtexp_rmpoorsamp) %>%
filter(!is.na(Prediction)) %>%
select(-c(NSWID))
# Add in GP from iter 48
iter_48_GP <- read.csv("~/RBGSyd_Technical Officer/MQuin/Seedling GWAS/Filtering/Iteration 6/data/GAPIT_48/prediction_gt.csv"); colnames(iter_48_GP)[1] <- "LIBRARY"
prev_exp_pedi <- read.csv("~/Uni/Doctorate/Samples/Seedlot_plot_data/data/prev_exp_pedi.csv")
prev_exp_pedi$FID <- gsub ("_", "", prev_exp_pedi$FID)
iter_48_GP_pedi <- left_join(iter_48_GP, prev_exp_pedi) %>%
select(LIBRARY, FID, Prediction, PEV)
colnames(prediction_gt_droughtexp_rmpoorsamp) <- c("LIBRARY", "FID", "Prediction", "PEV")
iter_48_GP_pedi_drought <- rbind(prediction_gt_droughtexp_rmpoorsamp, iter_48_GP_pedi)
iter_48_GP_pedi_summ <- iter_48_GP_pedi_drought %>%
group_by(FID) %>%
summarise(Seedling_number_genompred = n(),
Mean_seedling_score_genompred = mean(Prediction, na.rm=T),
Sd_seedling_score_genompred = sd(Prediction, na.rm=T))
colnames(iter_48_GP_pedi_summ)[1] <- "Seedlot"
JB_db_iter48 <- left_join(JB_db_MatlineGenompred, iter_48_GP_pedi_summ)
JB_db_iter48$Mean_seedling_score_genompred[JB_db_iter48$Mean_seedling_score_genompred<0] = 0
write.csv(JB_db_iter48, "~/Uni/Doctorate/Samples/Seedlot_plot_data/final_seedloty_plot.csv", row.names=F)
runApp('Seedlot_plot_ShinyMap')
View(JB_db_iter48)
unique(JB_db_iter48$Seedlot)
duplicated(JB_db_iter48$Seedlot)
# Load in datasets used
LoadedinData <- read.csv("data/final_seedloty_plot.csv")
runApp('Seedlot_plot_ShinyMap')
runApp('Seedlot_plot_ShinyMap')
